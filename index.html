<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <style>
    body {
      font-family: 'Noto Sans Bengali', sans-serif;
    }
    .expense-card {
      transition: transform 0.2s, opacity 0.2s;
    }
    .expense-card:hover {
      transform: scale(1.02);
    }
    .chart-container {
      background-color: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      position: relative;
      min-height: 300px;
      max-height: 450px;
      height: 350px; /* Default for mobile */
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .chart-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
      min-height: 280px;
    }
    .chart-grid {
      gap: 1rem;
    }
    @media (max-width: 640px) {
      .desktop-table {
        display: none;
      }
      .chart-container {
        height: 350px !important;
        padding: 0.75rem;
        min-height: 320px;
      }
      .chart-grid {
        gap: 0.5rem !important;
      }
    }
    @media (min-width: 641px) and (max-width: 1024px) {
      .chart-container {
        height: 400px !important;
        padding: 1rem;
        min-height: 350px;
      }
      .chart-grid {
        gap: 0.75rem !important;
      }
    }
    @media (min-width: 1025px) {
      .chart-container {
        height: 450px !important;
        padding: 1.25rem;
        min-height: 400px;
      }
      .chart-grid {
        gap: 1rem !important;
      }
      .mobile-cards {
        display: none;
      }
    }
    #editModal, #userModal, #deleteUserModal {
      transition: opacity 0.3s ease-in-out;
    }
    .progress-bar {
      height: 20px;
      background-color: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      transition: width 0.3s ease-in-out;
    }
    .report-card {
      background-color: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .report-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .dark .report-card {
      background-color: #1e293b !important;
      border: 1px solid #334155 !important;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.5) !important;
    }
    .dark .chart-container {
      background-color: #1e293b !important;
      border: 1px solid #334155 !important;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.5) !important;
    }
    .dark .report-card p,
    .dark .report-card span,
    .dark .chart-container h3 {
      color: #f1f5f9 !important;
    }
    .dark .report-card .text-indigo-600,
    .dark .report-card .text-indigo-400 {
      color: #818cf8 !important;
    }
    .dark .report-card .text-gray-800 {
      color: #e2e8f0 !important;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
  <div class="container mx-auto p-4 sm:p-6 max-w-4xl">
    <!-- User Profile and Navigation -->
    <div class="flex justify-between items-center mb-4">
      <div class="flex items-center gap-4">
        <button id="userProfileButton" class="bg-indigo-500 text-white p-2 rounded hover:bg-indigo-600">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</button>
        <span id="currentUser" class="text-lg font-semibold"></span>
      </div>
      <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 p-2 rounded-full w-10 h-10 flex items-center justify-center">
        <span id="themeIcon">üåô</span>
      </button>
    </div>

    <!-- User Profile Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
      <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2>
        <p class="mb-4 text-sm">‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        <input type="text" id="userName" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="border p-2 rounded w-full mb-4 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <select id="userSelect" class="border p-2 rounded w-full mb-4 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
          <option value="">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        </select>
        <div class="flex gap-4">
          <button onclick="saveUserProfile()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 flex-1">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button onclick="deleteUserPrompt()" class="bg-red-500 text-white p-2 rounded hover:bg-red-600 flex-1">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
          <button onclick="closeUserModal()" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600 flex-1">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
      </div>
    </div>

    <!-- Delete User Confirmation Modal -->
    <div id="deleteUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
      <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md w-full max-w-sm">
        <h2 class="text-lg font-semibold mb-4">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <p class="mb-4">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶ñ‡¶∞‡¶ö ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§</p>
        <div class="flex gap-4">
          <button onclick="deleteUser()" class="bg-red-500 text-white p-2 rounded hover:bg-red-600 flex-1">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å</button>
          <button onclick="closeDeleteUserModal()" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600 flex-1">‡¶®‡¶æ</button>
        </div>
      </div>
    </div>

    <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</h1>

    <!-- Budget Form -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="number" id="totalBudget" min="0" placeholder="‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü (‡¶ü‡¶æ‡¶ï‡¶æ)" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <input type="number" id="foodBudget" min="0" placeholder="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <input type="number" id="transportBudget" min="0" placeholder="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <input type="number" id="entertainmentBudget" min="0" placeholder="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <input type="number" id="billBudget" min="0" placeholder="‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <input type="number" id="otherBudget" min="0" placeholder="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <button onclick="saveBudget()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 sm:col-span-2 text-lg">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
      <div class="mt-4">
        <h3 class="text-lg font-semibold">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</h3>
        <div class="mt-2">
          <p>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü: <span id="totalBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="totalProgress" class="progress-fill bg-blue-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-2">
          <p>‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞: <span id="foodBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="foodProgress" class="progress-fill bg-green-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-2">
          <p>‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®: <span id="transportBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="transportProgress" class="progress-fill bg-purple-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-2">
          <p>‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®: <span id="entertainmentBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="entertainmentProgress" class="progress-fill bg-yellow-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-2">
          <p>‡¶¨‡¶ø‡¶≤: <span id="billBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="billProgress" class="progress-fill bg-red-500" style="width: 0%"></div>
          </div>
        </div>
        <div class="mt-2">
          <p>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø: <span id="otherBudgetDisplay">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          <div class="progress-bar">
            <div id="otherProgress" class="progress-fill bg-indigo-500" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Expense Form -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="date" id="date" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <input type="text" id="description" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶Ø‡ßá‡¶Æ‡¶®, ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞)" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <input type="number" id="amount" min="0" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <select id="category" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
          <option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
          <option value="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®">‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®">‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶≤</option>
          <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
        </select>
        <input type="text" id="notes" placeholder="‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="border p-2 rounded w-full sm:col-span-2 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <button onclick="addExpense()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 sm:col-span-2 text-lg">‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

    <!-- Filter and Export -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶ñ‡¶∞‡¶ö ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
        <input type="date" id="filterStartDate" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" placeholder="‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
        <input type="date" id="filterEndDate" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" placeholder="‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
        <select id="filterCategory" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
          <option value="">‡¶∏‡¶¨ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>
          <option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
          <option value="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®">‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®">‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶≤</option>
          <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
        </select>
      </div>
      <div class="flex flex-wrap gap-4">
        <button onclick="filterExpenses()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 text-lg flex-1 min-w-[100px]">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button onclick="exportToCSV()" class="bg-purple-500 text-white p-2 rounded hover:bg-purple-600 text-lg flex-1 min-w-[100px]">CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
        <button onclick="printExpenses()" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600 text-lg flex-1 min-w-[100px]">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

    <!-- Expense List -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
      <!-- Desktop Table -->
      <div class="desktop-table overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-gray-200 dark:bg-gray-700">
              <th class="p-2 border dark:border-gray-600">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
              <th class="p-2 border dark:border-gray-600">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
              <th class="p-2 border dark:border-gray-600">‡¶ü‡¶æ‡¶ï‡¶æ</th>
              <th class="p-2 border dark:border-gray-600">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
              <th class="p-2 border dark:border-gray-600">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
              <th class="p-2 border dark:border-gray-600">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
            </tr>
          </thead>
          <tbody id="expenseTable"></tbody>
        </table>
      </div>
      <!-- Mobile Cards -->
      <div class="mobile-cards space-y-4" id="expenseCards"></div>
      <p class="mt-4 text-lg font-semibold">‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: <span id="totalAmount">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
    </div>

    <!-- Monthly Report and Charts -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</h2>
      <div class="flex flex-col sm:flex-row gap-4 mb-4">
        <input type="month" id="reportMonth" class="border p-2 rounded bg-gray-50 dark:bg-gray-700 dark:text-gray-100 flex-1">
        <button onclick="generateMonthlyReport()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 text-lg">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
      </div>
      <div id="monthlyReport" class="report-card mb-4 text-gray-900 dark:text-slate-100">
        <p class="text-gray-900 dark:text-slate-100">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§ ‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
      </div>
      <div class="chart-grid grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="chart-container">
          <h3 class="text-lg font-bold mb-2 text-gray-900 dark:text-slate-100">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö (‡¶™‡¶æ‡¶á ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü)</h3>
          <canvas id="categoryChart"></canvas>
        </div>
        <div class="chart-container">
          <h3 class="text-lg font-bold mb-2 text-gray-900 dark:text-slate-100">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶° (‡¶≤‡¶æ‡¶á‡¶® ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü)</h3>
          <canvas id="timelineChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
      <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md w-full max-w-lg">
        <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶ñ‡¶∞‡¶ö ‡¶á‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <input type="date" id="editDate" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
          <input type="text" id="editDescription" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
          <input type="number" id="editAmount" min="0" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
          <select id="editCategory" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
            <option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
            <option value="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®">‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®</option>
            <option value="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®">‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®</option>
            <option value="‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶≤</option>
            <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
          </select>
          <input type="text" id="editNotes" placeholder="‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="border p-2 rounded w-full sm:col-span-2 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        </div>
        <div class="flex gap-4 mt-4">
          <button onclick="saveEditedExpense()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 flex-1">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <button onclick="closeEditModal()" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600 flex-1">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log('JavaScript loaded');
    let currentUser = localStorage.getItem('currentUser') || null;
    let expenses = [];
    let filteredExpenses = [];
    let budget = {};
    let editingIndex = null;
    let categoryChart = null;
    let timelineChart = null;

    // Local Storage Fallback
    function getLocalStorageItem(key, defaultValue) {
      try {
        if (key === 'users') {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : defaultValue;
        }
        const item = localStorage.getItem(`${currentUser}_${key}`);
        return item ? JSON.parse(item) : defaultValue;
      } catch (error) {
        console.error(`Error accessing localStorage for ${key}:`, error);
        return defaultValue;
      }
    }

    function setLocalStorageItem(key, value) {
      try {
        if (key === 'users') {
          localStorage.setItem(key, JSON.stringify(value));
        } else {
          localStorage.setItem(`${currentUser}_${key}`, JSON.stringify(value));
        }
      } catch (error) {
        console.error(`Error setting localStorage for ${key}:`, error);
      }
    }

    // User Management
    function loadUserProfile() {
      console.log('Loading user profile');
      if (!currentUser) {
        showUserModal();
        showNotification('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®!', 'info');
        return;
      }
      document.getElementById('currentUser').textContent = currentUser;
      updateUserSelect();
      expenses = getLocalStorageItem('expenses', []);
      filteredExpenses = [...expenses];
      budget = getLocalStorageItem('budget', {
        total: 0,
        food: 0,
        transport: 0,
        entertainment: 0,
        bill: 0,
        other: 0
      });
      renderExpenses();
      updateBudgetProgress();
      generateMonthlyReport();
    }

    function updateUserSelect() {
      console.log('Updating user select dropdown');
      const users = getLocalStorageItem('users', []);
      const userSelect = document.getElementById('userSelect');
      userSelect.innerHTML = '<option value="">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
      users.forEach(user => {
        userSelect.innerHTML += `<option value="${user}" ${user === currentUser ? 'selected' : ''}>${user}</option>`;
      });
    }

    function saveUserProfile() {
      console.log('Saving user profile');
      const userName = document.getElementById('userName').value.trim();
      if (!userName) {
        showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
      }
      let users = getLocalStorageItem('users', []);
      if (!users.includes(userName)) {
        users.push(userName);
        setLocalStorageItem('users', users);
      }
      currentUser = userName;
      localStorage.setItem('currentUser', currentUser);
      loadUserProfile();
      closeUserModal();
      showNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${userName}`, 'success');
    }

    function switchUser() {
      const userSelect = document.getElementById('userSelect').value;
      if (userSelect) {
        currentUser = userSelect;
        localStorage.setItem('currentUser', currentUser);
        loadUserProfile();
        showNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${currentUser}`, 'success');
      }
    }

    function showUserModal() {
      console.log('Showing user modal');
      updateUserSelect();
      document.getElementById('userModal').classList.remove('hidden');
    }

    function closeUserModal() {
      console.log('Closing user modal');
      document.getElementById('userModal').classList.add('hidden');
      document.getElementById('userName').value = '';
    }

    function deleteUserPrompt() {
      console.log('Showing delete user confirmation');
      if (!currentUser) {
        showNotification('‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º!', 'error');
        return;
      }
      document.getElementById('deleteUserModal').classList.remove('hidden');
    }

    function deleteUser() {
      console.log('Deleting user:', currentUser);
      let users = getLocalStorageItem('users', []);
      users = users.filter(user => user !== currentUser);
      setLocalStorageItem('users', users);
      localStorage.removeItem(`${currentUser}_expenses`);
      localStorage.removeItem(`${currentUser}_budget`);
      localStorage.removeItem(`${currentUser}_theme`);
      currentUser = null;
      localStorage.removeItem('currentUser');
      loadUserProfile();
      closeDeleteUserModal();
      closeUserModal();
      showNotification('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function closeDeleteUserModal() {
      console.log('Closing delete user modal');
      document.getElementById('deleteUserModal').classList.add('hidden');
    }

    document.getElementById('userProfileButton').addEventListener('click', showUserModal);
    document.getElementById('userSelect').addEventListener('change', switchUser);

    // Dark Mode Toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    function setInitialTheme() {
      console.log('Setting initial theme');
      const savedTheme = getLocalStorageItem('theme', null);
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initialTheme = savedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.classList.toggle('dark', initialTheme === 'dark');
      themeIcon.textContent = initialTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      setLocalStorageItem('theme', initialTheme);
      console.log('Applied theme:', initialTheme);
      updateCharts();
    }

    function toggleTheme() {
      console.log('Theme toggle clicked');
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      themeIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      setLocalStorageItem('theme', isDark ? 'dark' : 'light');
      console.log('Theme set to:', isDark ? 'dark' : 'light');
      updateCharts();
    }

    themeToggle.addEventListener('click', toggleTheme);
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      const newTheme = e.matches ? 'dark' : 'light';
      document.documentElement.classList.toggle('dark', e.matches);
      themeIcon.textContent = e.matches ? '‚òÄÔ∏è' : 'üåô';
      setLocalStorageItem('theme', newTheme);
      updateCharts();
    });
    setInitialTheme();

    // Notification
    function showNotification(message, type = 'info') {
      const colors = {
        success: '#22c55e',
        error: '#ef4444',
        info: '#3b82f6'
      };
      Toastify({
        text: message,
        duration: 3000,
        close: true,
        gravity: 'top',
        position: 'right',
        backgroundColor: colors[type],
        stopOnFocus: true
      }).showToast();
    }

    // Budget Management
    function saveBudget() {
      console.log('Saving budget');
      const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
      const foodBudget = parseFloat(document.getElementById('foodBudget').value) || 0;
      const transportBudget = parseFloat(document.getElementById('transportBudget').value) || 0;
      const entertainmentBudget = parseFloat(document.getElementById('entertainmentBudget').value) || 0;
      const billBudget = parseFloat(document.getElementById('billBudget').value) || 0;
      const otherBudget = parseFloat(document.getElementById('otherBudget').value) || 0;

      if (totalBudget < 0 || foodBudget < 0 || transportBudget < 0 || entertainmentBudget < 0 || billBudget < 0 || otherBudget < 0) {
        showNotification('‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Æ‡¶æ‡¶® ‡¶®‡ßá‡¶ó‡ßá‡¶ü‡¶ø‡¶≠ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶®‡¶æ!', 'error');
        return;
      }

      budget = {
        total: totalBudget,
        food: foodBudget,
        transport: transportBudget,
        entertainment: entertainmentBudget,
        bill: billBudget,
        other: otherBudget
      };
      setLocalStorageItem('budget', budget);
      updateBudgetProgress();
      showNotification('‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
      checkBudgetLimits();
    }

    function updateBudgetProgress() {
      console.log('Updating budget progress');
      const categoryTotals = {
        ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞: 0,
        ‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®: 0,
        ‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®: 0,
        ‡¶¨‡¶ø‡¶≤: 0,
        ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø: 0
      };
      let totalSpent = 0;

      expenses.forEach(expense => {
        categoryTotals[expense.category] += expense.amount;
        totalSpent += expense.amount;
      });

      document.getElementById('totalBudgetDisplay').textContent = budget.total.toFixed(2);
      document.getElementById('foodBudgetDisplay').textContent = budget.food.toFixed(2);
      document.getElementById('transportBudgetDisplay').textContent = budget.transport.toFixed(2);
      document.getElementById('entertainmentBudgetDisplay').textContent = budget.entertainment.toFixed(2);
      document.getElementById('billBudgetDisplay').textContent = budget.bill.toFixed(2);
      document.getElementById('otherBudgetDisplay').textContent = budget.other.toFixed(2);

      const totalProgress = budget.total ? (totalSpent / budget.total) * 100 : 0;
      document.getElementById('totalProgress').style.width = `${Math.min(totalProgress, 100)}%`;
      document.getElementById('totalProgress').style.backgroundColor = totalProgress > 100 ? '#ef4444' : '#3b82f6';

      const foodProgress = budget.food ? (categoryTotals['‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞'] / budget.food) * 100 : 0;
      document.getElementById('foodProgress').style.width = `${Math.min(foodProgress, 100)}%`;
      document.getElementById('foodProgress').style.backgroundColor = foodProgress > 100 ? '#ef4444' : '#22c55e';

      const transportProgress = budget.transport ? (categoryTotals['‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®'] / budget.transport) * 100 : 0;
      document.getElementById('transportProgress').style.width = `${Math.min(transportProgress, 100)}%`;
      document.getElementById('transportProgress').style.backgroundColor = transportProgress > 100 ? '#ef4444' : '#8b5cf6';

      const entertainmentProgress = budget.entertainment ? (categoryTotals['‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®'] / budget.entertainment) * 100 : 0;
      document.getElementById('entertainmentProgress').style.width = `${Math.min(entertainmentProgress, 100)}%`;
      document.getElementById('entertainmentProgress').style.backgroundColor = entertainmentProgress > 100 ? '#ef4444' : '#eab308';

      const billProgress = budget.bill ? (categoryTotals['‡¶¨‡¶ø‡¶≤'] / budget.bill) * 100 : 0;
      document.getElementById('billProgress').style.width = `${Math.min(billProgress, 100)}%`;
      document.getElementById('billProgress').style.backgroundColor = billProgress > 100 ? '#ef4444' : '#ef4444';

      const otherProgress = budget.other ? (categoryTotals['‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'] / budget.other) * 100 : 0;
      document.getElementById('otherProgress').style.width = `${Math.min(otherProgress, 100)}%`;
      document.getElementById('otherProgress').style.backgroundColor = otherProgress > 100 ? '#ef4444' : '#6366f1';
    }

    function checkBudgetLimits() {
      console.log('Checking budget limits');
      const categoryTotals = {
        ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞: 0,
        ‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®: 0,
        ‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®: 0,
        ‡¶¨‡¶ø‡¶≤: 0,
        ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø: 0
      };
      let totalSpent = 0;

      expenses.forEach(expense => {
        categoryTotals[expense.category] += expense.amount;
        totalSpent += expense.amount;
      });

      if (budget.total && totalSpent > budget.total) {
        showNotification(`‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${totalSpent.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
      if (budget.food && categoryTotals['‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞'] > budget.food) {
        showNotification(`‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${categoryTotals['‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞'].toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
      if (budget.transport && categoryTotals['‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®'] > budget.transport) {
        showNotification(`‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${categoryTotals['‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®'].toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
      if (budget.entertainment && categoryTotals['‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®'] > budget.entertainment) {
        showNotification(`‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${categoryTotals['‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®'].toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
      if (budget.bill && categoryTotals['‡¶¨‡¶ø‡¶≤'] > budget.bill) {
        showNotification(`‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${categoryTotals['‡¶¨‡¶ø‡¶≤'].toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
      if (budget.other && categoryTotals['‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'] > budget.other) {
        showNotification(`‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá! (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º: ${categoryTotals['‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'].toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ)`, 'error');
      }
    }

    // Expense Management
    function addExpense() {
      console.log('Adding expense');
      const date = document.getElementById('date').value;
      const description = document.getElementById('description').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const category = document.getElementById('category').value;
      const notes = document.getElementById('notes').value;

      if (!date) {
        showNotification('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!', 'error');
        return;
      }
      if (!description) {
        showNotification('‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
      }
      if (isNaN(amount) || amount <= 0) {
        showNotification('‡¶¨‡ßà‡¶ß ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
      }

      const expense = { date, description, amount, category, notes };
      expenses.push(expense);
      setLocalStorageItem('expenses', expenses);
      filteredExpenses = [...expenses];
      renderExpenses();
      updateBudgetProgress();
      checkBudgetLimits();
      generateMonthlyReport();
      clearForm();
      showNotification('‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function editExpense(index) {
      console.log('Editing expense at index:', index);
      editingIndex = index;
      const expense = expenses[index];
      document.getElementById('editDate').value = expense.date;
      document.getElementById('editDescription').value = expense.description;
      document.getElementById('editAmount').value = expense.amount;
      document.getElementById('editCategory').value = expense.category;
      document.getElementById('editNotes').value = expense.notes;
      document.getElementById('editModal').classList.remove('hidden');
    }

    function saveEditedExpense() {
      console.log('Saving edited expense');
      const date = document.getElementById('editDate').value;
      const description = document.getElementById('editDescription').value.trim();
      const amount = parseFloat(document.getElementById('editAmount').value);
      const category = document.getElementById('editCategory').value;
      const notes = document.getElementById('editNotes').value;

      if (!date) {
        showNotification('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!', 'error');
        return;
      }
      if (!description) {
        showNotification('‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
      }
      if (isNaN(amount) || amount <= 0) {
        showNotification('‡¶¨‡ßà‡¶ß ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!', 'error');
        return;
      }

      expenses[editingIndex] = { date, description, amount, category, notes };
      setLocalStorageItem('expenses', expenses);
      filteredExpenses = [...expenses];
      renderExpenses();
      updateBudgetProgress();
      checkBudgetLimits();
      generateMonthlyReport();
      closeEditModal();
      showNotification('‡¶ñ‡¶∞‡¶ö ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function closeEditModal() {
      console.log('Closing edit modal');
      document.getElementById('editModal').classList.add('hidden');
      editingIndex = null;
    }

    function deleteExpense(index) {
      console.log('Deleting expense at index:', index);
      expenses.splice(index, 1);
      setLocalStorageItem('expenses', expenses);
      filteredExpenses = [...expenses];
      renderExpenses();
      updateBudgetProgress();
      checkBudgetLimits();
      generateMonthlyReport();
      showNotification('‡¶ñ‡¶∞‡¶ö ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function renderExpenses() {
      console.log('Rendering expenses');
      const tableBody = document.getElementById('expenseTable');
      const cardContainer = document.getElementById('expenseCards');
      if (!tableBody || !cardContainer) {
        console.error('Expense table or cards container not found');
        return;
      }
      tableBody.innerHTML = '';
      cardContainer.innerHTML = '';
      let total = 0;

      filteredExpenses.forEach((expense, index) => {
        total += expense.amount;

        // Desktop Table
        const row = `
          <tr>
            <td class="p-2 border dark:border-gray-600">${expense.date}</td>
            <td class="p-2 border dark:border-gray-600">${expense.description}</td>
            <td class="p-2 border dark:border-gray-600">${expense.amount}</td>
            <td class="p-2 border dark:border-gray-600">${expense.category}</td>
            <td class="p-2 border dark:border-gray-600">${expense.notes}</td>
            <td class="p-2 border dark:border-gray-600">
              <button onclick="editExpense(${index})" class="text-blue-500 hover:underline mr-2">‡¶á‡¶°‡¶ø‡¶ü</button>
              <button onclick="deleteExpense(${index})" class="text-red-500 hover:underline">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            </td>
          </tr>`;
        tableBody.innerHTML += row;

        // Mobile Card
        const card = `
          <div class="expense-card bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow">
            <p><strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${expense.date}</p>
            <p><strong>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</strong> ${expense.description}</p>
            <p><strong>‡¶ü‡¶æ‡¶ï‡¶æ:</strong> ${expense.amount}</p>
            <p><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</strong> ${expense.category}</p>
            <p><strong>‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${expense.notes || '-'}</p>
            <div class="mt-2 flex gap-2">
              <button onclick="editExpense(${index})" class="text-blue-500 hover:underline">‡¶á‡¶°‡¶ø‡¶ü</button>
              <button onclick="deleteExpense(${index})" class="text-red-500 hover:underline">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            </div>
          </div>`;
        cardContainer.innerHTML += card;
      });

      document.getElementById('totalAmount').textContent = total.toFixed(2);
    }

    function clearForm() {
      console.log('Clearing form');
      document.getElementById('date').value = '';
      document.getElementById('description').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('category').value = '‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞';
      document.getElementById('notes').value = '';
    }

    function filterExpenses() {
      console.log('Filtering expenses');
      const startDate = document.getElementById('filterStartDate').value;
      const endDate = document.getElementById('filterEndDate').value;
      const category = document.getElementById('filterCategory').value;

      filteredExpenses = expenses.filter(expense => {
        let matches = true;
        if (startDate && expense.date < startDate) matches = false;
        if (endDate && expense.date > endDate) matches = false;
        if (category && expense.category !== category) matches = false;
        return matches;
      });

      renderExpenses();
    }

    function exportToCSV() {
      console.log('Exporting to CSV');
      const headers = ['‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ,‡¶¨‡¶ø‡¶¨‡¶∞‡¶£,‡¶ü‡¶æ‡¶ï‡¶æ,‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø,‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø'];
      const rows = filteredExpenses.map(expense => 
        `${expense.date},${expense.description},${expense.amount},${expense.category},${expense.notes}`
      );
      const csvContent = headers.concat(rows).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'expenses.csv';
      link.click();
      showNotification('CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function printExpenses() {
      console.log('Printing expenses');
      const printContent = document.querySelector('.desktop-table').outerHTML;
      const total = document.getElementById('totalAmount').textContent;
      const userName = currentUser || '‡¶á‡¶â‡¶ú‡¶æ‡¶∞';
      const printWindow = window.open('', '', 'height=600,width=800');
      printWindow.document.write(`
        <html>
          <head>
            <title>‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</title>
            <style>
              body { font-family: 'Noto Sans Bengali', sans-serif; }
              table { width: 100%; border-collapse: collapse; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${userName} - ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
            ${printContent}
            <p><strong>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: ${total} ‡¶ü‡¶æ‡¶ï‡¶æ</strong></p>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
      showNotification('‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
    }

    function generateMonthlyReport() {
      console.log('Generating monthly report');
      const reportMonth = document.getElementById('reportMonth').value;
      if (!reportMonth) {
        document.getElementById('monthlyReport').innerHTML = `<p class="text-gray-900 dark:text-slate-100">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§ ‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>`;
        updateCharts([]);
        return;
      }

      const [year, month] = reportMonth.split('-');
      const filteredByMonth = expenses.filter(expense => 
        expense.date.startsWith(`${year}-${month}`)
      );

      let total = 0;
      const categoryBreakdown = {};
      filteredByMonth.forEach(expense => {
        total += expense.amount;
        categoryBreakdown[expense.category] = (categoryBreakdown[expense.category] || 0) + expense.amount;
      });

      let reportHTML = `
        <div class="space-y-4">
          <div>
            <p class="text-lg font-semibold">‡¶Æ‡¶æ‡¶∏: <span class="text-indigo-600 dark:text-indigo-400">${year}-${month}</span></p>
            <p class="text-lg font-semibold">‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: <span class="text-indigo-600 dark:text-indigo-400">${total.toFixed(2)}</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
          </div>
          <div>
            <p class="text-md font-semibold mb-2 text-gray-900 dark:text-slate-100">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ñ‡¶∞‡¶ö:</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm font-medium text-gray-800 dark:text-slate-200">
      `;
      for (const [category, amount] of Object.entries(categoryBreakdown)) {
        reportHTML += `<div class="flex justify-between"><span>${category}</span><span>${amount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</span></div>`;
      }
      reportHTML += `
            </div>
          </div>
        </div>
      `;

      document.getElementById('monthlyReport').innerHTML = reportHTML;
      updateCharts(filteredByMonth, year, month);
    }

    function updateCharts(filteredExpenses = [], year, month) {
      console.log('Updating charts');
      const isDarkMode = document.documentElement.classList.contains('dark');
      const textColor = isDarkMode ? '#f1f5f9' : '#111827';
      const gridColor = isDarkMode ? '#475569' : '#d1d5db';
      const isMobile = window.innerWidth <= 640;
      const isTablet = window.innerWidth > 640 && window.innerWidth <= 1024;
      const fontSize = isMobile ? 10 : isTablet ? 12 : 14;
      const titleFontSize = isMobile ? 12 : isTablet ? 14 : 16;
      const legendPadding = isMobile ? 8 : isTablet ? 12 : 16;

      const categoryBreakdown = {};
      filteredExpenses.forEach(expense => {
        categoryBreakdown[expense.category] = (categoryBreakdown[expense.category] || 0) + expense.amount;
      });

      // Pie Chart
      if (categoryChart) categoryChart.destroy();
      categoryChart = new Chart(document.getElementById('categoryChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(categoryBreakdown),
          datasets: [{
            data: Object.values(categoryBreakdown),
            backgroundColor: ['#34d399', '#a855f7', '#facc15', '#f87171', '#3b82f6', '#f472b6', '#9ca3af', '#2dd4bf'],
            hoverOffset: 20,
            borderWidth: 1,
            borderColor: isDarkMode ? '#e2e8f0' : '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { 
              position: isMobile ? 'bottom' : 'top', 
              labels: { 
                font: { size: fontSize, family: 'Noto Sans Bengali' }, 
                color: textColor,
                padding: legendPadding,
                boxWidth: isMobile ? 30 : 40
              } 
            },
            title: { 
              display: true, 
              text: '‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö', 
              font: { size: titleFontSize, family: 'Noto Sans Bengali' }, 
              color: textColor,
              padding: { top: 8, bottom: 8 }
            },
            tooltip: {
              bodyFont: { size: fontSize, family: 'Noto Sans Bengali' },
              titleFont: { size: fontSize + 2, family: 'Noto Sans Bengali' }
            }
          }
        }
      });

      // Line Chart
      const dailyTotals = {};
      filteredExpenses.forEach(expense => {
        const date = expense.date;
        dailyTotals[date] = (dailyTotals[date] || 0) + expense.amount;
      });

      const sortedDates = Object.keys(dailyTotals).sort();
      if (timelineChart) timelineChart.destroy();

      const ctx = document.getElementById('timelineChart').getContext('2d');
      const gradient = ctx.createLinearGradient(0, 0, 0, isMobile ? 300 : isTablet ? 350 : 400);
      gradient.addColorStop(0, isDarkMode ? 'rgba(129, 140, 248, 0.8)' : 'rgba(59, 130, 246, 0.8)');
      gradient.addColorStop(1, isDarkMode ? 'rgba(165, 180, 252, 0.2)' : 'rgba(96, 165, 250, 0.2)');

      timelineChart = new Chart(document.getElementById('timelineChart'), {
        type: 'line',
        data: {
          labels: sortedDates,
          datasets: [{
            label: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö',
            data: sortedDates.map(date => dailyTotals[date]),
            borderColor: isDarkMode ? '#818cf8' : '#3b82f6',
            backgroundColor: gradient,
            fill: true,
            tension: 0.4,
            pointRadius: isMobile ? 3 : 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { 
              position: isMobile ? 'bottom' : 'top', 
              labels: { 
                font: { size: fontSize, family: 'Noto Sans Bengali' }, 
                color: textColor,
                padding: legendPadding,
                boxWidth: isMobile ? 30 : 40
              } 
            },
            title: { 
              display: true, 
              text: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶°', 
              font: { size: titleFontSize, family: 'Noto Sans Bengali' }, 
              color: textColor,
              padding: { top: 8, bottom: 8 }
            },
            tooltip: {
              bodyFont: { size: fontSize, family: 'Noto Sans Bengali' },
              titleFont: { size: fontSize + 2, family: 'Noto Sans Bengali' }
            }
          },
          scales: {
            x: { 
              title: { 
                display: true, 
                text: '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', 
                font: { size: fontSize + 2, family: 'Noto Sans Bengali' }, 
                color: textColor,
                padding: { top: 4 }
              },
              grid: { color: gridColor },
              ticks: { 
                font: { size: fontSize, family: 'Noto Sans Bengali' }, 
                color: textColor,
                maxRotation: isMobile ? 45 : 0,
                minRotation: isMobile ? 45 : 0
              }
            },
            y: { 
              title: { 
                display: true, 
                text: '‡¶ü‡¶æ‡¶ï‡¶æ', 
                font: { size: fontSize + 2, family: 'Noto Sans Bengali' }, 
                color: textColor,
                padding: { bottom: 4 }
              }, 
              beginAtZero: true,
              grid: { color: gridColor },
              ticks: { 
                font: { size: fontSize, family: 'Noto Sans Bengali' }, 
                color: textColor 
              }
            }
          }
        }
      });
    }

    // Initial Setup on Page Load
    try {
      loadUserProfile();
      document.getElementById('reportMonth').addEventListener('change', generateMonthlyReport);
      console.log('Initial render complete');
    } catch (error) {
      console.error('Error during initial render:', error);
      showNotification('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'error');
    }
  </script>
</body>
</html>